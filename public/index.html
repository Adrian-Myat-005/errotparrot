<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ErrotParrot 3.0</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

    <!-- Admin Floating Button (Hidden by default) -->
    <button id="btn-admin-float" class="admin-fab hidden" onclick="document.getElementById('modal-admin').classList.remove('hidden')">‚öôÔ∏è</button>

    <div class="app-shell">
        
        <!-- Header -->
        <header class="app-header">
            <div class="brand">
                <span class="logo-icon">ü¶ú</span>
                <div class="brand-text">
                    <h1>ErrotParrot</h1>
                    <div class="hud">
                        <span class="badge-pill">Lv.<span id="hud-lvl">1</span></span>
                        <div class="xp-track"><div id="hud-xp-bar" class="xp-fill"></div></div>
                        <span class="streak-pill">üî• <span id="hud-streak">0</span></span>
                        <span class="energy-pill">‚ö° <span id="hud-energy">5</span> <small id="hud-energy-timer" style="display:none">00:00</small></span>
                    </div>
                </div>
            </div>
            <div class="premium-nav-box">
                <span id="premium-time-left" class="premium-timer-badge hidden"></span>
                <button id="btn-premium-nav" class="btn-premium">Get Premium</button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-body">
            
            <!-- Screen: Lesson List -->
            <section id="screen-lessons" class="screen">
                
                <!-- Stats Row -->
                <div class="stats-overview">
                    <div class="stat-card">
                        <span class="stat-val" id="stat-completed">0</span>
                        <span class="stat-label">Completed</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-val" id="stat-xp">0</span>
                        <span class="stat-label">Total XP</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-val" id="stat-rank">Newbie</span>
                        <span class="stat-label">Rank</span>
                    </div>
                </div>

                <!-- Teacher Bot Banner -->
                <div class="teacher-banner" onclick="startTeacherMode()">
                    <div class="teacher-icon">üë©‚Äçüè´</div>
                    <div class="teacher-info">
                        <h3>Tr. Adrian</h3>
                        <p>Start adaptive AI conversation</p>
                    </div>
                    <div class="teacher-arrow">‚Üí</div>
                </div>

                <div class="search-bar-sticky">
                    <input type="text" id="lesson-search" placeholder="Search lessons...">
                </div>
                
                <div class="tabs-scroll">
                    <button class="tab-btn active" data-type="all">All</button>
                    <button class="tab-btn" data-type="conversation">Conversation</button>
                    <button class="tab-btn" data-type="grammar">Grammar</button>
                    <button class="tab-btn" data-type="exam">Exams</button>
                </div>

                <div id="lesson-list" class="lesson-grid">
                    <!-- Lessons will appear here -->
                </div>
            </section>

            <!-- Screen: Active Practice -->
            <section id="screen-active" class="screen hidden">
                <div class="active-header">
                    <button id="btn-back" class="icon-btn">‚Üê</button>
                    <div class="active-meta">
                        <h2 id="active-title">...</h2>
                        <span id="active-badge" class="badge">Mode</span>
                    </div>
                </div>

                <div id="chat-box" class="chat-viewport hidden">
                    <div id="chat-list" class="chat-list"></div>
                    <div id="ai-typing" class="typing-indicator hidden">Thinking...</div>
                </div>

                <div id="shadow-box" class="shadow-viewport hidden">
                    <div class="card-shadow">
                        <h3 id="active-role">...</h3>
                        <div id="shadow-text">...</div>
                    </div>
                </div>

                <div id="grammar-box" class="grammar-viewport hidden">
                    <div class="grammar-content">
                        <div id="grammar-notes" class="notes-area"></div>
                        <div id="grammar-quiz" class="quiz-area hidden">
                            <h3 id="quiz-question">Question?</h3>
                            <div id="quiz-options" class="options-grid"></div>
                        </div>
                        <button id="btn-start-quiz" class="btn-main">Start Quick Quiz</button>
                    </div>
                </div>

                <div class="active-controls-wrapper">
                    <div id="active-feedback" class="feedback-toast hidden"></div>
                    <div id="score-display" class="score-pill hidden">Score: <span id="score-val">0</span>%</div>
                    <div id="correction-box" class="correction-card hidden">
                        <h4>üí° Suggestions</h4>
                        <div id="correction-text"></div>
                    </div>
                    
                    <div class="control-row" id="active-controls">
                        <button id="btn-listen" class="btn-round" title="Listen to AI">üîä</button>
                        <button id="btn-relisten-user" class="btn-round hidden" title="Listen to Me">üëÇ</button>
                        <button id="btn-record" class="btn-main">üé§ Tap to Speak</button>
                        <button id="btn-next" class="btn-main hidden">Next ‚Üí</button>
                    </div>
                    
                    <div class="settings-row">
                        <div class="setting-item">
                            <label>Leader:</label>
                            <select id="select-leader" class="mini-select">
                                <option value="ai">Tr. Adrian</option>
                                <option value="user">Me</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Voice:</label>
                            <select id="select-voice" class="mini-select">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Speed:</label>
                            <select id="select-speed" class="mini-select">
                                <option value="0.8">0.8x</option>
                                <option value="1.0" selected>1.0x</option>
                                <option value="1.2">1.2x</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

        </main>

    </div>

    <!-- Modals -->
    
    <div id="modal-premium" class="modal-overlay hidden">
        <div class="modal-card">
            <button class="close-modal" onclick="closeAllModals()">√ó</button>
            <div class="modal-header">
                <h2>Upgrade Experience</h2>
                <p>Unlock Tr. Adrian and Ad-Free learning.</p>
            </div>

            <div class="pricing-options">
                <div class="plan-card">
                    <div class="badge-plan">ECONOMY</div>
                    <h3>API License</h3>
                    <div class="price">1,000 MMK / mo</div>
                    <ul class="features">
                        <li>üë©‚Äçüè´ Full Access to Tr. Adrian</li>
                        <li>‚ö° Infinite Energy (BYO Key)</li>
                        <li>‚è±Ô∏è Shorter 10s Lesson Ads</li>
                    </ul>
                    <input type="password" id="input-api-key" placeholder="Paste Groq API Key" class="input-field">
                    <button class="btn-buy" onclick="window.open('https://t.me/Amyat604')">Get Key Unlock</button>
                </div>

                <div class="plan-card featured">
                    <div class="badge-plan gold">BEST VALUE</div>
                    <h3>Pro Access</h3>
                    <div class="price">10,000 MMK / mo</div>
                    <ul class="features">
                        <li>üíé 100% Ad-Free Lessons</li>
                        <li>üë©‚Äçüè´ Full Access to Tr. Adrian</li>
                        <li>üöÄ 60 Energy / Day (Included)</li>
                    </ul>
                    <button class="btn-buy gold" onclick="window.open('https://t.me/Amyat604')">Get Full Access</button>
                </div>
            </div>

            <div class="redeem-section">
                <input type="text" id="input-redeem-code" placeholder="Enter EP-XXXX Code">
                <button id="btn-redeem-submit" class="btn-small">Redeem</button>
            </div>
        </div>
    </div>

    <div id="modal-admin" class="modal-overlay hidden">
        <div class="modal-card">
            <button class="close-modal" onclick="closeAllModals()">√ó</button>
            <div class="modal-header">
                <h2>Admin Panel</h2>
                <p>Manage system and generate tokens.</p>
            </div>
            <div class="admin-tools">
                <div class="admin-group">
                    <label>Ad YouTube ID:</label>
                    <div class="flex-row">
                        <input type="text" id="admin-ad-url" class="input-field" placeholder="Video ID">
                        <button id="btn-admin-save-ad" class="btn-small">Save</button>
                    </div>
                </div>
                <hr>
                <div class="admin-group">
                    <label>Generate Premium Code:</label>
                    <select id="admin-code-type" class="input-field">
                        <option value="api-license">API License</option>
                        <option value="pro-access">Pro Access</option>
                    </select>
                    <button id="btn-admin-gen" class="btn-main">Generate EP-Token</button>
                    <div id="admin-result" class="code-display">Code will appear here...</div>
                </div>
                <hr>
                <button id="btn-admin-refill" class="btn-secondary" onclick="state.userEnergy=60; updateHUD(); alert('Energy Refilled');">Refill My Energy</button>
            </div>
        </div>
    </div>

    <div id="modal-ad" class="modal-overlay hidden">
        <div class="modal-card center-text">
            <h2>Unlock Lesson</h2>
            <p>Wait for the timer to unlock this lesson.</p>
            <div class="video-placeholder">
                <iframe id="ad-iframe" width="100%" height="100%" src="" frameborder="0"></iframe>
            </div>
            <div id="ad-timer" class="ad-countdown">30s</div>
            <button id="btn-ad-claim" class="btn-main hidden">Unlock Now</button>
        </div>
    </div>

    <div id="modal-levelup" class="modal-overlay hidden">
        <div class="modal-card center-text">
            <div style="font-size:4rem;">üéä</div>
            <h1>Level Up!</h1>
            <p>You've reached a new level. Energy refilled!</p>
            <button class="btn-main" onclick="closeAllModals()">Awesome!</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>