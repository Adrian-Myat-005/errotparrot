<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ErrorParrot | Mastery</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <div class="app-shell">
        
        <!-- App Header -->
        <header class="app-header">
            <button id="btn-back-main" class="icon-btn hidden">‚úï</button>
            <div class="progress-container">
                <div id="progress-bar" class="progress-fill"></div>
            </div>
            <div class="hud-stats">
                <span class="hud-energy">‚ö° <span id="hud-energy">50</span></span>
                <button id="btn-show-activation" class="btn-pro-badge">PRO</button>
            </div>
        </header>

        <main class="app-main">
            
            <!-- Screen: Lessons -->
            <section id="screen-lessons" class="screen">
                <div class="scroll-area">
                    <div style="padding: 32px 24px;">
                        <h1 style="font-size: 2.2rem; font-weight: 800; letter-spacing: -0.05em; line-height: 1;">Ready for Mastery?</h1>
                        <p style="color: var(--text-muted); margin-top: 8px; font-weight: 600;">Unlock your fluency one phrase at a time.</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 0 24px 24px;">
                        <div style="background: var(--bg); padding: 16px; border-radius: 20px; text-align: center;">
                            <span id="stat-streak" style="display: block; font-size: 1.4rem; font-weight: 800;">0</span>
                            <span style="font-size: 0.7rem; color: var(--text-muted); font-weight: 800; text-transform: uppercase;">Streak</span>
                        </div>
                        <div style="background: var(--bg); padding: 16px; border-radius: 20px; text-align: center;">
                            <span id="stat-xp" style="display: block; font-size: 1.4rem; font-weight: 800;">0</span>
                            <span style="font-size: 0.7rem; color: var(--text-muted); font-weight: 800; text-transform: uppercase;">Total XP</span>
                        </div>
                        <div style="background: var(--bg); padding: 16px; border-radius: 20px; text-align: center;">
                            <span id="stat-done" style="display: block; font-size: 1.4rem; font-weight: 800;">0</span>
                            <span style="font-size: 0.7rem; color: var(--text-muted); font-weight: 800; text-transform: uppercase;">Units</span>
                        </div>
                    </div>

                    <div style="padding: 0 24px 24px;">
                        <button id="btn-resume" class="btn-pro">üöÄ RESUME LEARNING</button>
                    </div>

                    <div style="position: sticky; top: 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); z-index: 10; display: flex; gap: 8px; overflow-x: auto; padding: 16px 24px; scrollbar-width: none;">
                        <button class="tab-btn active" data-type="all" style="padding: 10px 20px; border-radius: 100px; border: none; background: var(--bg); font-weight: 800; cursor: pointer;">All</button>
                        <button class="tab-btn" data-type="teacher" style="padding: 10px 20px; border-radius: 100px; border: none; background: var(--bg); font-weight: 800; cursor: pointer;">üë®‚Äçüè´ Teacher</button>
                        <button class="tab-btn" data-type="grammar" style="padding: 10px 20px; border-radius: 100px; border: none; background: var(--bg); font-weight: 800; cursor: pointer;">Grammar</button>
                        <button class="tab-btn" data-type="test" style="padding: 10px 20px; border-radius: 100px; border: none; background: var(--bg); font-weight: 800; cursor: pointer;">Tests</button>
                        <button class="tab-btn" data-type="memory" style="padding: 10px 20px; border-radius: 100px; border: none; background: var(--bg); font-weight: 800; cursor: pointer;">‚≠ê Memory</button>
                    </div>

                    <div style="padding: 12px 24px 20px;">
                        <input type="text" id="lesson-search" placeholder="Search lessons..." style="width: 100%; padding: 16px; border-radius: 16px; border: 1px solid var(--border); background: var(--bg); font-family: inherit; font-weight: 700;">
                    </div>

                    <div id="lesson-list">
                        <div style="padding: 60px; text-align: center; color: var(--text-muted); font-weight: 700;">Loading System...</div>
                    </div>
                </div>
            </section>

            <!-- Screen: Practice -->
            <section id="screen-active" class="screen hidden">
                <div class="practice-view">
                    <div class="practice-top">
                        <button id="btn-restart-lesson" class="icon-btn" style="color: var(--danger);">üîÑ</button>
                        <div style="font-weight: 800; color: var(--text-muted); font-size: 0.9rem;">
                            <span id="current-phrase-num">1</span> / <span id="total-phrase-num">50</span>
                        </div>
                        <button id="btn-save-phrase" class="icon-btn" style="color: #eab308;">‚òÜ</button>
                    </div>

                    <div class="practice-main">
                        <div id="grammar-note" class="hidden" style="background: var(--purple-soft); color: var(--purple-dark); padding: 20px; border-radius: 20px; text-align: left; margin-bottom: 20px; font-weight: 600;"></div>
                        <div id="grammar-test-area" class="hidden" style="width: 100%;">
                            <div id="grammar-question" style="font-weight: 800; font-size: 1.2rem; margin-bottom: 24px;"></div>
                            <div id="grammar-options" style="display: grid; gap: 12px;"></div>
                        </div>
                        <div id="karaoke-text" class="karaoke-text">...</div>
                        <div id="translation-text" class="translation-text">...</div>
                        <div id="chat-history" class="hidden"></div>
                    </div>

                    <footer class="practice-footer">
                        <div class="controls-row">
                            <button id="btn-listen" class="btn-circle">üîä</button>
                            <button id="btn-record" class="btn-mic-pro">üé§ RECORD</button>
                        </div>

                        <div class="settings-bar">
                            <div class="select-box">
                                <label>Speed</label>
                                <select id="select-speed" class="mini-select">
                                    <option value="0.8">0.8x</option>
                                    <option value="1.0" selected>1.0x</option>
                                    <option value="1.2">1.2x</option>
                                </select>
                            </div>
                            <div class="select-box">
                                <label>Voice</label>
                                <select id="select-voice" class="mini-select">
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                            <div class="select-box">
                                <label>Lead</label>
                                <select id="select-leader" class="mini-select">
                                    <option value="ai">AI</option>
                                    <option value="user">User</option>
                                </select>
                            </div>
                            <div class="select-box">
                                <label>Time</label>
                                <select id="select-duration" class="mini-select">
                                    <option value="1">1m</option>
                                    <option value="2">2m</option>
                                    <option value="5" selected>5m</option>
                                </select>
                            </div>
                        </div>
                    </footer>

                    <!-- Final Action Overlay -->
                    <div id="feedback-overlay" class="feedback-overlay">
                        <div id="feedback-status" class="feedback-status">
                            <span id="feedback-icon"></span>
                            <span id="feedback-label"></span>
                        </div>
                        <div id="correction-display" class="correction-box"></div>
                        <div id="feedback-tip" class="tip-text"></div>
                        <div class="feedback-actions">
                            <button id="btn-relisten" class="btn-pro ghost" style="flex: 1;">üëÇ LISTEN</button>
                            <button id="btn-next-step" class="btn-pro primary" style="flex: 2; display: none;">CONTINUE</button>
                            <button id="btn-retry-step" class="btn-pro secondary" style="flex: 2; display: none;">TRY AGAIN</button>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modals -->
    <div id="modal-energy" class="modal-overlay hidden">
        <div class="modal-card">
            <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 8px;">No Energy</h2>
            <p style="color: var(--text-muted); font-weight: 600; margin-bottom: 24px;">Wait for refill or upgrade to Pro for unlimited mastery sessions.</p>
            <button class="btn-pro primary" onclick="window.open('https://t.me/Amyat604')">UPGRADE PRO</button>
            <button onclick="closeAllModals()" style="margin-top: 16px; background: none; border: none; color: var(--text-muted); font-weight: 800; cursor: pointer;">Maybe later</button>
        </div>
    </div>

    <div id="modal-ad" class="modal-overlay hidden">
        <div class="modal-card" style="max-width: 440px;">
            <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 8px;">Unlock Lesson</h2>
            <p style="color: var(--text-muted); font-weight: 600; margin-bottom: 20px;">Watch this short video to unlock this specialized session.</p>
            
            <div id="ad-video-container" style="width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 20px; display: none; position: relative;">
                <div id="youtube-player"></div>
                <!-- Click Blocker Overlay -->
                <div id="yt-blocker" style="position: absolute; inset: 0; z-index: 10; cursor: default;"></div>
            </div>

            <button id="btn-watch-ad" class="btn-pro secondary">WATCH AD TO UNLOCK</button>
            <button id="btn-close-ad" onclick="closeAllModals()" style="margin-top: 16px; background: none; border: none; color: var(--text-light); font-weight: 800; cursor: pointer;">Cancel</button>
        </div>
    </div>

    <div id="modal-adrian" class="modal-overlay hidden">
        <div class="modal-card">
            <h2 style="font-size: 1.8rem; font-weight: 800; margin-bottom: 8px;">Premium AI Tutor</h2>
            <p style="color: var(--text-muted); font-weight: 600; margin-bottom: 24px;">Activate Tr. Adrian for personalized coaching and unlimited practice.</p>
            <input type="text" id="input-redeem" placeholder="Activation Code" style="width: 100%; padding: 18px; border-radius: 16px; border: 1px solid var(--border); background: var(--bg); margin-bottom: 16px; text-align: center; font-weight: 800; font-size: 1.1rem;">
            <button id="btn-redeem" class="btn-pro secondary" style="margin-bottom: 12px;">ACTIVATE</button>
            <button class="btn-pro" onclick="window.open('https://t.me/Amyat604')" style="background: var(--text);">GET CODE</button>
            <button onclick="closeAllModals()" style="margin-top: 16px; background: none; border: none; color: var(--text-muted); font-weight: 800; cursor: pointer;">Dismiss</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="app.js"></script>
</body>
</html>